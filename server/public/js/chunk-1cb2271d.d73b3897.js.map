{"version":3,"sources":["webpack:///./src/views/cms/imgs.vue?696b","webpack:///./src/views/cms/imgs.vue","webpack:///./src/views/cms/imgs.vue?5a40","webpack:///./src/service/photo/photos.ts"],"names":["class","title","segmented","action","uploadURL","default-file-list","fileList","list-type","handlePreview","handleFinish","removeImg","headers","getToken","show","showModal","preset","style","src","previewImageUrl","setup","router","showModalRef","previewImageUrlRef","url","file","message","Authorization","store","token","event","res","JSON","id_","item","id","status","__exports__","render","getAllPhotos","get","createPhoto","data","post","deletePhotoById","delete"],"mappings":"kHAAA,W,2ICCE,eAA6B,MAAzBA,MAAM,SAAQ,UAAM,I,GACnBA,MAAM,Q,iBAWN,U,gLAZL,EACA,eAwBM,MAxBN,EAwBM,CAtBJ,eAYS,GAZDC,MAAM,MAAOC,UAAW,kB,wBAC9B,IAUW,CAVX,eAUW,GATRC,OAAQ,EAAAC,UACRC,oBAAmB,EAAAC,SACpBC,YAAU,aACT,UAAS,EAAAC,cACT,SAAQ,EAAAC,aACR,SAAQ,EAAAC,UACRC,QAAS,EAAAC,U,wBACX,IAED,C,+FAGF,eAOU,GANAC,KAAM,EAAAC,U,+BAAA,EAAAA,UAAS,GACvBC,OAAO,OACPC,MAAA,gBACAf,MAAM,S,wBAEN,IAAkD,CAAlD,eAAkD,OAA5CgB,IAAK,EAAAC,gBAAiBF,MAAA,gB,u1BAiBnB,qBAAgB,CAC7BG,MAD6B,WAG3B,IAAMb,EAAW,eAAjB,IACMc,EAAS,iBAETC,EAAe,gBAArB,GACMC,EAAqB,eAA3B,IACA,cACE,IAAQC,EAAQC,EAAhB,IACAF,EAAA,QACAD,EAAA,SAGF,IAAMjB,EAAY,cACZqB,EAAU,iBACVb,EAAW,WACf,MAAO,CACLc,cAAeC,EAAA,iBAAkBC,QAG/BnB,EAAe,SAAC,GAAoB,IAAlBe,EAAkB,EAAlBA,KAAMK,EAAY,EAAZA,MACtBC,EAAMC,KAAA,MAAWF,EAAA,OAAvB,UACA,SAAIA,EAAA,cAGF,OAFAT,EAAA,oBACAK,EAAA,MAAcK,EAAdL,SAGFA,EAAA,QAAgBK,EAAhBL,SACA,eAAY,CAAEF,IAAKO,EAAA,UAAcP,MAAjC,MAA6C,YAC3CC,EAAA,IAAWM,EAAA,UAAX,MAEFN,EAAA,IAAW,IAAsCM,EAAA,KAAjD,KAGIpB,EAAY,SAAC,GAAa,IAAXc,EAAW,EAAXA,KACnB,eAAgBA,EAAhB,MAiBF,OAfA,gBAAU,WAER,uBAAoB,YAAS,OAC3B,EAAAlB,EAAA,sBACKwB,EAAA,eAAkB,YACnB,MAAO,CACLE,IAAKC,EADA,GAELC,GAAID,EAFC,GAGLV,IAAK,IAAsCU,EAHtC,IAILE,OAAQ,uBAMX,CACL3B,cADK,EAELM,UAFK,EAGLI,gBAHK,EAILZ,SAJK,EAKLG,aALK,EAMLL,UANK,EAOLQ,SAPK,EAQLF,gB,iCC/FN,MAAM0B,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAE1E,gB,oCCTf,sHAEM,SAAUC,IACd,OAAO,OAASC,IAAI,CAClBhB,IAAK,gBAIH,SAAUiB,EAAYC,GAC1B,OAAO,OAASC,KAAK,CACnBnB,IAAK,aACLkB,KAAI,IAGF,SAAUE,EAAgBT,GAC9B,OAAO,OAASU,OAAO,CACrBrB,IAAK,cAAgBW,M","file":"js/chunk-1cb2271d.d73b3897.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./imgs.vue?vue&type=style&index=0&id=5acd7291&lang=less&scoped=true\"","<template>\n  <h2 class=\"title\">images</h2>\n  <div class=\"blog\">\n    <!-- photo manage -->\n    <n-card title=\"图片墙\" :segmented=\"{ content: 'soft' }\">\n      <n-upload\n        :action=\"uploadURL\"\n        :default-file-list=\"fileList\"\n        list-type=\"image-card\"\n        @preview=\"handlePreview\"\n        @finish=\"handleFinish\"\n        @remove=\"removeImg\"\n        :headers=\"getToken\"\n      >\n        点击上传\n      </n-upload>\n    </n-card>\n    <!-- image modal -->\n    <n-modal\n      v-model:show=\"showModal\"\n      preset=\"card\"\n      style=\"width: 600px\"\n      title=\"麻衣学姐！\"\n    >\n      <img :src=\"previewImageUrl\" style=\"width: 100%\" />\n    </n-modal>\n  </div>\n</template>\n\n<script>\nimport { defineComponent, onMounted, ref } from 'vue';\nimport { useMessage } from 'naive-ui';\nimport store from '@/store';\nimport { useRouter } from 'vue-router';\n\nimport {\n  getAllPhotos,\n  createPhoto,\n  deletePhotoById,\n} from '@/service/photo/photos';\n\nexport default defineComponent({\n  setup() {\n    // 初始图片墙\n    const fileList = ref([]);\n    const router = useRouter();\n    // img preview\n    const showModalRef = ref(false);\n    const previewImageUrlRef = ref('');\n    function handlePreview(file) {\n      const { url } = file;\n      previewImageUrlRef.value = url;\n      showModalRef.value = true;\n    }\n    // img upload\n    const uploadURL = process.env.VUE_APP_IMAGE_LOAD_BASE + 'api/upload';\n    const message = useMessage();\n    const getToken = () => {\n      return {\n        Authorization: store.state.login.token,\n      };\n    };\n    const handleFinish = ({ file, event }) => {\n      const res = JSON.parse(event.target.response);\n      if (event.target.status === 401) {\n        router.push('/login');\n        message.error(res.message);\n        return;\n      }\n      message.success(res.message);\n      createPhoto({ url: res.data.file.url }).then((res) => {\n        file._id = res.data.data.id;\n      });\n      file.url = process.env.VUE_APP_IMAGE_LOAD_BASE + res.data.url;\n    };\n    // 删除图片\n    const removeImg = ({ file }) => {\n      deletePhotoById(file.id_);\n    };\n    onMounted(() => {\n      // 初始化数据\n      getAllPhotos().then((res) => {\n        fileList.value.push(\n          ...res.data.data.map((item) => {\n            return {\n              id_: item.id,\n              id: item.id,\n              url: process.env.VUE_APP_IMAGE_LOAD_BASE + item.url,\n              status: 'finished',\n            };\n          }),\n        );\n      });\n    });\n    return {\n      handlePreview,\n      showModal: showModalRef,\n      previewImageUrl: previewImageUrlRef,\n      fileList,\n      handleFinish,\n      uploadURL,\n      getToken,\n      removeImg,\n    };\n  },\n});\n</script>\n\n<style lang=\"less\" scoped>\n.blog {\n  margin-left: 30px;\n  margin-right: 40px;\n}\n</style>\n","import { render } from \"./imgs.vue?vue&type=template&id=5acd7291&scoped=true\"\nimport script from \"./imgs.vue?vue&type=script&lang=js\"\nexport * from \"./imgs.vue?vue&type=script&lang=js\"\n\nimport \"./imgs.vue?vue&type=style&index=0&id=5acd7291&lang=less&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\86199\\\\Desktop\\\\work-space\\\\full\\\\myblog\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-5acd7291\"]])\n\nexport default __exports__","import { sRequest } from '../index';\n\nexport function getAllPhotos(): Promise<any> {\n  return sRequest.get({\n    url: '/api/photos',\n  });\n}\n\nexport function createPhoto(data: any): Promise<any> {\n  return sRequest.post({\n    url: '/api/photo',\n    data,\n  });\n}\nexport function deletePhotoById(id: number): Promise<any> {\n  return sRequest.delete({\n    url: '/api/photo/' + id,\n  });\n}\n"],"sourceRoot":""}